{% extends 'base.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/receipt_list.css' %}">
{% endblock %}

{% block content %}
<div class="receipt-list-container">
    <div class="receipt-list-wrapper">
        <div class="receipt-list-row">
            <div class="receipt-list-col">
                <div class="receipt-list-header">
                    <h3 class="receipt-list-title">{{ title }}</h3>
                    <a href="{% url 'add_receipt' %}" class="receipt-list-add-btn">
                        <i class="fas fa-plus"></i> Add Receipt
                    </a>
                </div>
                
                <div class="receipt-list-content">
                    <!-- Export Buttons -->
                    <div class="receipt-list-export-buttons no-print">
                        <button onclick="printReceipts()" class="receipt-list-print-btn">
                            <i class="fas fa-print"></i> Print (Ctrl+P)
                        </button>
                        <a href="{% url 'export_receipts_pdf' %}?{{ request.GET.urlencode }}" target="_blank" class="receipt-list-pdf-btn">
                            <i class="fas fa-file-pdf"></i> Export PDF
                        </a>
                        <a href="{% url 'export_receipts_excel' %}?{{ request.GET.urlencode }}" class="receipt-list-excel-btn">
                            <i class="fas fa-file-excel"></i> Export Excel
                        </a>
                    </div>

                    <!-- Filter Form -->
                    <div class="receipt-list-filter-form no-print">
                        <form method="get" class="receipt-list-filter">
                            <div class="receipt-list-filter-group">
                                <label for="search" class="receipt-list-filter-label">Search</label>
                                <input type="text" id="search" name="search" class="receipt-list-search-input"
                                       value="{{ search_query }}" placeholder="Description, Reference...">
                            </div>
                            <div class="receipt-list-filter-group">
                                <label for="start_date" class="receipt-list-filter-label">From Date</label>
                                <input type="date" id="start_date" name="start_date" class="receipt-list-date-input"
                                       value="{{ start_date }}">
                            </div>
                            <div class="receipt-list-filter-group">
                                <label for="end_date" class="receipt-list-filter-label">To Date</label>
                                <input type="date" id="end_date" name="end_date" class="receipt-list-date-input"
                                       value="{{ end_date }}">
                            </div>
                            <div class="receipt-list-filter-group">
                                <label class="receipt-list-filter-label">&nbsp;</label>
                                <div class="receipt-list-filter-btn-group">
                                    <button type="submit" class="receipt-list-filter-btn">
                                        <i class="fas fa-search"></i> Filter
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Total Summary -->
                    <div class="receipt-list-summary">
                        <div class="receipt-list-summary-row">
                            <div class="receipt-list-summary-col">
                                <h5 class="receipt-list-total">Total Receipts: ₹{{ total_amount|floatformat:2 }}</h5>
                            </div>
                            <div class="receipt-list-summary-col">
                                <small class="receipt-list-count">{{ receipts.paginator.count }} receipt(s) found</small>
                            </div>
                        </div>
                    </div>

                    <!-- Print Area (Hidden by default) -->
                    <div class="receipt-list-print-area">
                        <div class="receipt-list-print-header">
                            <h2>Receipts Report</h2>
                            <p>Generated on: {{ "now"|date:"d-m-Y H:i" }}</p>
                        </div>
                    </div>

                    <!-- Receipts Table -->
                    <div class="receipt-list-table-wrapper">
                        <table id="receiptsTable" class="receipt-list-table">
                            <thead class="receipt-list-table-head">
                                <tr class="receipt-list-table-header-row">
                                    <th class="receipt-list-table-header">Date</th>
                                    <th class="receipt-list-table-header">Amount</th>
                                    <th class="receipt-list-table-header">Method</th>
                                    <th class="receipt-list-table-header">Description</th>
                                    <th class="receipt-list-table-header">Reference</th>
                                    <th class="receipt-list-table-header no-print">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="receipt-list-table-body">
                                {% for receipt in receipts %}
                                <tr class="receipt-list-table-row">
                                    <td class="receipt-list-table-cell">{{ receipt.receipt_date|date:"d-m-Y" }}</td>
                                    <td class="receipt-list-table-cell">₹{{ receipt.receipt_amount|floatformat:2 }}</td>
                                    <td class="receipt-list-table-cell">{{ receipt.get_receipt_method_display }}</td>
                                    <td class="receipt-list-table-cell">{{ receipt.receipt_description|default:"-" }}</td>
                                    <td class="receipt-list-table-cell">{{ receipt.receipt_reference|default:"-" }}</td>
                                    <td class="receipt-list-table-cell no-print">
                                        <div class="receipt-list-actions" role="group">
                                            <a href="{% url 'edit_receipt' receipt.receipt_id %}" class="receipt-list-edit-btn">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <a href="{% url 'delete_receipt' receipt.receipt_id %}" class="receipt-list-delete-btn"
                                               onclick="return confirm('Are you sure you want to delete this receipt?')">
                                                <i class="fas fa-trash"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr class="receipt-list-empty-row">
                                    <td colspan="6" class="receipt-list-empty-cell">No receipts found.</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    {% if receipts.has_other_pages %}
                    <nav aria-label="Receipts pagination" class="receipt-list-pagination no-print">
                        <ul class="receipt-list-pagination-list">
                            {% if receipts.has_previous %}
                                <li class="receipt-list-pagination-item">
                                    <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if start_date %}&start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}" class="receipt-list-pagination-link">First</a>
                                </li>
                                <li class="receipt-list-pagination-item">
                                    <a href="?page={{ receipts.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if start_date %}&start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}" class="receipt-list-pagination-link">Previous</a>
                                </li>
                            {% endif %}

                            <li class="receipt-list-pagination-item">
                                <span class="receipt-list-pagination-current">
                                    Page {{ receipts.number }} of {{ receipts.paginator.num_pages }}
                                </span>
                            </li>

                            {% if receipts.has_next %}
                                <li class="receipt-list-pagination-item">
                                    <a href="?page={{ receipts.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if start_date %}&start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}" class="receipt-list-pagination-link">Next</a>
                                </li>
                                <li class="receipt-list-pagination-item">
                                    <a href="?page={{ receipts.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if start_date %}&start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}" class="receipt-list-pagination-link">Last</a>
                                </li>
                            {% endif %}
                        </ul>
                    </nav>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function printReceipts() {
    window.print();
}

// Keyboard shortcut for print
document.addEventListener('keydown', function(e) {
    if (e.ctrlKey && e.key === 'p') {
        e.preventDefault();
        printReceipts();
    }
});

// Auto-submit form on date change
document.getElementById('start_date').addEventListener('change', function() {
    if (this.value && document.getElementById('end_date').value) {
        this.form.submit();
    }
});

document.getElementById('end_date').addEventListener('change', function() {
    if (this.value && document.getElementById('start_date').value) {
        this.form.submit();
    }
});
</script>
{% endblock %}







