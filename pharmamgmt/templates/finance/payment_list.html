{% extends 'base.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/payment_list.css' %}">
{% endblock %}

{% block content %}
<div class="payment-list-container">
    <div class="payment-list-wrapper">
        <div class="payment-list-row">
            <div class="payment-list-col">
                <div class="payment-list-header">
                    <h3 class="payment-list-title">{{ title }}</h3>
                    <a href="{% url 'add_payment' %}" class="payment-list-add-btn">
                        <i class="fas fa-plus"></i> Add Payment
                    </a>
                </div>
                
                <div class="payment-list-content">
                    <!-- Export Buttons -->
                    <div class="payment-list-export-buttons no-print">
                        <button onclick="printPayments()" class="payment-list-print-btn">
                            <i class="fas fa-print"></i> Print (Ctrl+P)
                        </button>
                        <a href="{% url 'export_payments_pdf' %}?{{ request.GET.urlencode }}" target="_blank" class="payment-list-pdf-btn">
                            <i class="fas fa-file-pdf"></i> Export PDF
                        </a>
                        <a href="{% url 'export_payments_excel' %}?{{ request.GET.urlencode }}" class="payment-list-excel-btn">
                            <i class="fas fa-file-excel"></i> Export Excel
                        </a>
                    </div>

                    <!-- Filter Form -->
                    <div class="payment-list-filter-form no-print">
                        <form method="get" class="payment-list-filter">
                            <div class="payment-list-filter-group">
                                <label for="search" class="payment-list-filter-label">Search</label>
                                <input type="text" id="search" name="search" class="payment-list-search-input"
                                       value="{{ search_query }}" placeholder="Description, Reference...">
                            </div>
                            <div class="payment-list-filter-group">
                                <label for="start_date" class="payment-list-filter-label">From Date</label>
                                <input type="date" id="start_date" name="start_date" class="payment-list-date-input"
                                       value="{{ start_date }}">
                            </div>
                            <div class="payment-list-filter-group">
                                <label for="end_date" class="payment-list-filter-label">To Date</label>
                                <input type="date" id="end_date" name="end_date" class="payment-list-date-input"
                                       value="{{ end_date }}">
                            </div>
                            <div class="payment-list-filter-group">
                                <label class="payment-list-filter-label">&nbsp;</label>
                                <div class="payment-list-filter-btn-group">
                                    <button type="submit" class="payment-list-filter-btn">
                                        <i class="fas fa-search"></i> Filter
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Total Summary -->
                    <div class="payment-list-summary">
                        <div class="payment-list-summary-row">
                            <div class="payment-list-summary-col">
                                <h5 class="payment-list-total">Total Payments: ₹{{ total_amount|floatformat:2 }}</h5>
                            </div>
                            <div class="payment-list-summary-col">
                                <small class="payment-list-count">{{ payments.paginator.count }} payment(s) found</small>
                            </div>
                        </div>
                    </div>

                    <!-- Print Area (Hidden by default) -->
                    <div class="payment-list-print-area">
                        <div class="payment-list-print-header">
                            <h2>Payments Report</h2>
                            <p>Generated on: {{ "now"|date:"d-m-Y H:i" }}</p>
                        </div>
                    </div>

                    <!-- Payments Table -->
                    <div class="payment-list-table-wrapper">
                        <table id="paymentsTable" class="payment-list-table">
                            <thead class="payment-list-table-head">
                                <tr class="payment-list-table-header-row">
                                    <th class="payment-list-table-header">Date</th>
                                    <th class="payment-list-table-header">Amount</th>
                                    <th class="payment-list-table-header">Method</th>
                                    <th class="payment-list-table-header">Description</th>
                                    <th class="payment-list-table-header">Reference</th>
                                    <th class="payment-list-table-header no-print">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="payment-list-table-body">
                                {% for payment in payments %}
                                <tr class="payment-list-table-row">
                                    <td class="payment-list-table-cell">{{ payment.payment_date|date:"d-m-Y" }}</td>
                                    <td class="payment-list-table-cell">₹{{ payment.payment_amount|floatformat:2 }}</td>
                                    <td class="payment-list-table-cell">{{ payment.get_payment_method_display }}</td>
                                    <td class="payment-list-table-cell">{{ payment.payment_description|default:"-" }}</td>
                                    <td class="payment-list-table-cell">{{ payment.payment_reference|default:"-" }}</td>
                                    <td class="payment-list-table-cell no-print">
                                        <div class="payment-list-actions" role="group">
                                            <a href="{% url 'edit_payment' payment.payment_id %}" class="payment-list-edit-btn">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <a href="{% url 'delete_payment' payment.payment_id %}" class="payment-list-delete-btn"
                                               onclick="return confirm('Are you sure you want to delete this payment?')">
                                                <i class="fas fa-trash"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr class="payment-list-empty-row">
                                    <td colspan="6" class="payment-list-empty-cell">No payments found.</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    {% if payments.has_other_pages %}
                    <nav aria-label="Payments pagination" class="payment-list-pagination no-print">
                        <ul class="payment-list-pagination-list">
                            {% if payments.has_previous %}
                                <li class="payment-list-pagination-item">
                                    <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if start_date %}&start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}" class="payment-list-pagination-link">First</a>
                                </li>
                                <li class="payment-list-pagination-item">
                                    <a href="?page={{ payments.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if start_date %}&start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}" class="payment-list-pagination-link">Previous</a>
                                </li>
                            {% endif %}

                            <li class="payment-list-pagination-item">
                                <span class="payment-list-pagination-current">
                                    Page {{ payments.number }} of {{ payments.paginator.num_pages }}
                                </span>
                            </li>

                            {% if payments.has_next %}
                                <li class="payment-list-pagination-item">
                                    <a href="?page={{ payments.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if start_date %}&start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}" class="payment-list-pagination-link">Next</a>
                                </li>
                                <li class="payment-list-pagination-item">
                                    <a href="?page={{ payments.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if start_date %}&start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}" class="payment-list-pagination-link">Last</a>
                                </li>
                            {% endif %}
                        </ul>
                    </nav>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function printPayments() {
    window.print();
}

// Keyboard shortcut for print
document.addEventListener('keydown', function(e) {
    if (e.ctrlKey && e.key === 'p') {
        e.preventDefault();
        printPayments();
    }
});

// Auto-submit form on date change
document.getElementById('start_date').addEventListener('change', function() {
    if (this.value && document.getElementById('end_date').value) {
        this.form.submit();
    }
});

document.getElementById('end_date').addEventListener('change', function() {
    if (this.value && document.getElementById('start_date').value) {
        this.form.submit();
    }
});
</script>
{% endblock %}







