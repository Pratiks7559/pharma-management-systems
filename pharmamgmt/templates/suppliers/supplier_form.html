{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/supplier_form.css' %}">
{% endblock %}

{% block content %}
<div class="supplier-form-main-container">
    <div class="supplier-form-content-wrapper">
        <div class="supplier-form-card-container">
            <div class="supplier-form-header-section">
                <div class="supplier-form-title-wrapper">
                    <h5 class="supplier-form-main-heading">{% if supplier %}Update{% else %}Add{% endif %} Supplier</h5>
                </div>
            </div>
            <div class="supplier-form-body-section">
                <form method="post" class="supplier-form-main-form">
                        {% csrf_token %}
                        <div class="supplier-form-row">
                            <div class="supplier-form-col">
                                <label for="{{ form.supplier_name.id_for_label }}" class="supplier-form-label">Supplier Name*</label>
                                {{ form.supplier_name }}
                                {% if form.supplier_name.errors %}<div class="supplier-form-error">{{ form.supplier_name.errors }}</div>{% endif %}
                            </div>
                            <div class="supplier-form-col">
                                <label for="{{ form.supplier_type.id_for_label }}" class="supplier-form-label">Supplier Type*</label>
                                {{ form.supplier_type }}
                                {% if form.supplier_type.errors %}<div class="supplier-form-error">{{ form.supplier_type.errors }}</div>{% endif %}
                            </div>
                            <div class="supplier-form-col">
                                <label for="{{ form.supplier_mobile.id_for_label }}" class="supplier-form-label">Mobile*</label>
                                {{ form.supplier_mobile }}
                                {% if form.supplier_mobile.errors %}<div class="supplier-form-error">{{ form.supplier_mobile.errors }}</div>{% endif %}
                            </div>
                        </div>
                        
                        <div class="supplier-form-row">
                            <div class="supplier-form-col">
                                <label for="{{ form.supplier_whatsapp.id_for_label }}" class="supplier-form-label">WhatsApp*</label>
                                {{ form.supplier_whatsapp }}
                                {% if form.supplier_whatsapp.errors %}<div class="supplier-form-error">{{ form.supplier_whatsapp.errors }}</div>{% endif %}
                            </div>
                            <div class="supplier-form-col">
                                <label for="{{ form.supplier_emailid.id_for_label }}" class="supplier-form-label">Email*</label>
                                {{ form.supplier_emailid }}
                                {% if form.supplier_emailid.errors %}<div class="supplier-form-error">{{ form.supplier_emailid.errors }}</div>{% endif %}
                            </div>
                            <div class="supplier-form-col">
                                <label for="{{ form.supplier_spoc.id_for_label }}" class="supplier-form-label">Contact Person*</label>
                                {{ form.supplier_spoc }}
                                {% if form.supplier_spoc.errors %}<div class="supplier-form-error">{{ form.supplier_spoc.errors }}</div>{% endif %}
                            </div>
                        </div>
                        
                        <div class="supplier-form-row">
                            <div class="supplier-form-col">
                                <label for="{{ form.supplier_address.id_for_label }}" class="supplier-form-label">Address*</label>
                                {{ form.supplier_address }}
                                {% if form.supplier_address.errors %}<div class="supplier-form-error">{{ form.supplier_address.errors }}</div>{% endif %}
                            </div>
                            <div class="supplier-form-col">
                                <label for="{{ form.supplier_dlno.id_for_label }}" class="supplier-form-label">Drug License*</label>
                                {{ form.supplier_dlno }}
                                {% if form.supplier_dlno.errors %}<div class="supplier-form-error">{{ form.supplier_dlno.errors }}</div>{% endif %}
                            </div>
                            <div class="supplier-form-col">
                                <label for="{{ form.supplier_gstno.id_for_label }}" class="supplier-form-label">GST Number*</label>
                                {{ form.supplier_gstno }}
                                {% if form.supplier_gstno.errors %}<div class="supplier-form-error">{{ form.supplier_gstno.errors }}</div>{% endif %}
                            </div>
                        </div>
                        
                        <div class="supplier-form-row">
                            <div class="supplier-form-col">
                                <label for="{{ form.supplier_bank.id_for_label }}" class="supplier-form-label">Bank Name*</label>
                                {{ form.supplier_bank }}
                                {% if form.supplier_bank.errors %}<div class="supplier-form-error">{{ form.supplier_bank.errors }}</div>{% endif %}
                            </div>
                            <div class="supplier-form-col">
                                <label for="{{ form.supplier_bankaccountno.id_for_label }}" class="supplier-form-label">Account Number*</label>
                                {{ form.supplier_bankaccountno }}
                                {% if form.supplier_bankaccountno.errors %}<div class="supplier-form-error">{{ form.supplier_bankaccountno.errors }}</div>{% endif %}
                            </div>
                            <div class="supplier-form-col">
                                <label for="{{ form.supplier_bankifsc.id_for_label }}" class="supplier-form-label">IFSC Code*</label>
                                {{ form.supplier_bankifsc }}
                                {% if form.supplier_bankifsc.errors %}<div class="supplier-form-error">{{ form.supplier_bankifsc.errors }}</div>{% endif %}
                            </div>
                        </div>
                        
                        <div class="supplier-form-row">
                            <div class="supplier-form-col">
                                <label for="{{ form.supplier_upi.id_for_label }}" class="supplier-form-label">UPI ID</label>
                                {{ form.supplier_upi }}
                                {% if form.supplier_upi.errors %}<div class="supplier-form-error">{{ form.supplier_upi.errors }}</div>{% endif %}
                            </div>
                            <div class="supplier-form-col">
                                <!-- Empty column for spacing -->
                            </div>
                            <div class="supplier-form-col">
                                <!-- Empty column for spacing -->
                            </div>
                        </div>
                        
                        <div class="supplier-form-actions supplier-form-button-section">
                            <button type="submit" class="supplier-form-btn supplier-form-btn-primary supplier-form-submit-btn">
                                <i class="fas fa-save supplier-form-save-icon"></i>{% if supplier %}Update{% else %}Save{% endif %} Supplier
                            </button>
                            <a href="{% url 'supplier_list' %}" class="supplier-form-btn supplier-form-btn-secondary supplier-form-back-btn">
                                <i class="fas fa-arrow-left supplier-form-back-icon"></i>Back to Suppliers
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Enhanced auto focus first input
document.addEventListener('DOMContentLoaded', function() {
    function focusFirstInput() {
        const firstInput = document.querySelector('.supplier-form-main-form input[type="text"]') ||
                          document.querySelector('input[name*="supplier_name"]');
        
        if (firstInput) {
            firstInput.focus();
            console.log('✓ Supplier name field focused:', firstInput.name);
            return true;
        } else {
            console.error('❌ Supplier input field not found');
            return false;
        }
    }
    
    // Try multiple times with increasing delays
    setTimeout(focusFirstInput, 100);
    setTimeout(focusFirstInput, 300);
    setTimeout(focusFirstInput, 500);
});

// Check if opened in popup and handle form submission
if (window.opener) {
    document.querySelector('.supplier-form-main-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        
        fetch(this.action || window.location.href, {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Refresh parent window supplier dropdown
                if (window.opener && window.opener.location) {
                    window.opener.location.reload();
                }
                window.close();
            } else {
                // Handle form errors
                console.error('Form submission failed:', data.errors);
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    });
}
</script>
{% endblock %}








