{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/product_confirm_delete.css' %}">
<style>
.keyboard-hint {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 4px;
    padding: 8px 12px;
    margin-top: 15px;
    font-size: 12px;
    color: #6c757d;
    text-align: center;
}
.keyboard-hint kbd {
    background: #e9ecef;
    padding: 2px 6px;
    border-radius: 3px;
    font-family: monospace;
    font-size: 11px;
}
.delete-confirm-btn:focus,
.cancel-btn:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
}
</style>
{% endblock %}

{% block content %}
<div class="product-delete-container">
    <div class="product-delete-wrapper">
        <div class="product-delete-content">
            <div class="delete-confirmation-card">
                <div class="card-header">
                    <h5 class="delete-title">Confirm Delete</h5>
                </div>
                <div class="card-body">
                    <p class="warning-message">
                        <i class="fas fa-exclamation-triangle me-2 warning-icon"></i>
                        Are you sure you want to delete the product <strong class="product-name">{{ product.product_name }}</strong>?
                    </p>
                    <p class="consequence-text">This action cannot be undone. All data related to this product will be permanently removed from the system.</p>
                    
                    <form method="post" class="delete-form" id="deleteForm">
                        {% csrf_token %}
                        <div class="action-buttons">
                            <a href="{% url 'product_detail' pk=product.productid %}" class="cancel-btn" id="cancelBtn">
                                <i class="fas fa-times me-2"></i>Cancel
                            </a>
                            <button type="submit" class="delete-confirm-btn" id="deleteBtn" 
                                    data-item-name="{{ product.product_name }}" 
                                    data-item-type="Product"
                                    autofocus>
                                <i class="fas fa-trash me-2"></i>Delete Product
                            </button>
                        </div>
                    </form>
                    
                    <div class="keyboard-hint">
                        Press <kbd>Enter</kbd> to confirm deletion or <kbd>Esc</kbd> to cancel
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Enhanced keyboard navigation for delete confirmation
document.addEventListener('DOMContentLoaded', function() {
    const deleteBtn = document.getElementById('deleteBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const deleteForm = document.getElementById('deleteForm');
    
    // Auto-focus on delete button
    if (deleteBtn) {
        deleteBtn.focus();
    }
    
    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        switch(e.key) {
            case 'Enter':
                if (document.activeElement === deleteBtn) {
                    e.preventDefault();
                    // Show loading state
                    deleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Deleting...';
                    deleteBtn.disabled = true;
                    cancelBtn.style.opacity = '0.5';
                    cancelBtn.style.pointerEvents = 'none';
                    
                    // Submit form after a brief delay to show loading state
                    setTimeout(() => {
                        deleteForm.submit();
                    }, 100);
                }
                break;
            case 'Escape':
                e.preventDefault();
                window.location.href = cancelBtn.href;
                break;
            case 'Tab':
                // Cycle between cancel and delete buttons
                if (e.shiftKey) {
                    if (document.activeElement === cancelBtn) {
                        e.preventDefault();
                        deleteBtn.focus();
                    }
                } else {
                    if (document.activeElement === deleteBtn) {
                        e.preventDefault();
                        cancelBtn.focus();
                    }
                }
                break;
        }
    });
    
    // Visual feedback for focused button
    [deleteBtn, cancelBtn].forEach(btn => {
        if (btn) {
            btn.addEventListener('focus', function() {
                this.style.boxShadow = '0 0 0 3px rgba(0, 123, 255, 0.25)';
            });
            btn.addEventListener('blur', function() {
                this.style.boxShadow = '';
            });
        }
    });
    
    // Form submission handler
    deleteForm.addEventListener('submit', function(e) {
        if (deleteBtn.disabled) {
            e.preventDefault();
            return false;
        }
    });
});
</script>
{% endblock %}








